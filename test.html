<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Page - EMLE Buddy</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="icons/icon32.png">
    <style>
        /* Override for alert-text to match extension expectations */
        .alert-text {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <a href="index.html" class="logo">
                    <img src="icons/icon48.png" alt="EMLE Buddy Logo" width="32" height="32">
                    <span>EMLE Buddy</span>
                </a>
                <div class="nav-links">
                    <a href="index.html#features">Features</a>
                    <a href="privacy.html">Privacy Policy</a>
                </div>
            </nav>
        </div>
    </header>

    <main>
        <section class="hero" style="padding: 40px 0;">
            <div class="container">
                <h1>Extension Test Page</h1>
                <p>Simulate various edge cases to verify the extension's behavior.</p>
            </div>
        </section>

        <div class="container">
            <div class="alert alert-info">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                <div>
                    <strong>Test Scenarios</strong>
                    <ul class="test-scenarios-list">
                        <li>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            Normal questions
                        </li>
                        <li>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                            Delayed loading
                        </li>
                        <li>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                            Long questions
                        </li>
                        <li>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                            Missing choices
                        </li>
                        <li>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                            Rapid changes
                        </li>
                        <li>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                            Duplicates
                        </li>
                    </ul>
                    <div style="margin-top: 12px; font-size: 13px; opacity: 0.8;">
                        Instructions: Open console (F12) and check Telegram for messages!
                    </div>
                </div>
            </div>

            <div id="QuestionMain" class="question-display">
                <div class="alert-text">
                    What is the capital of France?
                </div>

                <div id="QuestionOptions">
                    <table class="options-table">
                        <tr>
                            <td>A</td>
                            <td>London</td>
                        </tr>
                        <tr>
                            <td>B</td>
                            <td>Paris</td>
                        </tr>
                        <tr>
                            <td>C</td>
                            <td>Berlin</td>
                        </tr>
                        <tr>
                            <td>D</td>
                            <td>Madrid</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="test-controls">
                <div class="control-section">
                    <h4>Normal Questions</h4>
                    <div class="button-grid">
                        <button class="btn btn-secondary" onclick="loadQuestion1()">
                            Geography
                        </button>
                        <button class="btn btn-secondary" onclick="loadQuestion2()">
                            Science
                        </button>
                        <button class="btn btn-secondary" onclick="loadQuestion3()">
                            Math
                        </button>
                    </div>
                </div>

                <div class="control-section">
                    <h4>Edge Cases</h4>
                    <div class="button-grid">
                        <button class="btn btn-warning" onclick="loadLongQuestion()">
                            <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                            Very Long Question
                        </button>
                        <button class="btn btn-warning" onclick="loadDelayedChoices()">
                            <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                            Delayed (2s)
                        </button>
                        <button class="btn btn-warning" onclick="loadDelayedChoicesSlow()">
                            <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                            Delayed (5s)
                        </button>
                        <button class="btn btn-danger" onclick="loadQuestionNoChoices()">
                            <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                            No Choices
                        </button>
                    </div>
                </div>

                <div class="control-section">
                    <h4>Stress Tests</h4>
                    <div class="button-grid">
                        <button class="btn btn-warning" onclick="rapidQuestionChange()">
                            <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                            Rapid Change
                        </button>
                        <button class="btn btn-secondary" onclick="loadDuplicate()">
                            <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                            Duplicate
                        </button>
                        <button class="btn btn-danger" onclick="removeQuestion()">
                            <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            Remove
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 EMLE Buddy. All rights reserved.</p>
        </div>
    </footer>

    <script>
        const questions = [
            {
                question: "What is the capital of France?",
                choices: [
                    { letter: "A", text: "London" },
                    { letter: "B", text: "Paris" },
                    { letter: "C", text: "Berlin" },
                    { letter: "D", text: "Madrid" }
                ]
            },
            {
                question: "What is the chemical symbol for water?",
                choices: [
                    { letter: "A", text: "O2" },
                    { letter: "B", text: "H2O" },
                    { letter: "C", text: "CO2" },
                    { letter: "D", text: "NaCl" }
                ]
            },
            {
                question: "What is 15 √ó 8?",
                choices: [
                    { letter: "A", text: "100" },
                    { letter: "B", text: "110" },
                    { letter: "C", text: "120" },
                    { letter: "D", text: "130" }
                ]
            },
            {
                question: "A 67-year-old man with a history of chronic obstructive pulmonary disease (COPD), hypertension, and type 2 diabetes mellitus presents to the emergency department with acute onset of severe dyspnea, productive cough with yellowish-green sputum, and fever of 38.9¬∞C (102¬∞F). He reports that his symptoms began 3 days ago and have progressively worsened despite using his home inhalers. On examination, he appears distressed, with a respiratory rate of 32 breaths/min, heart rate of 110 bpm, blood pressure of 145/90 mmHg, and oxygen saturation of 88% on room air. Auscultation reveals decreased breath sounds bilaterally with diffuse wheezing and scattered crackles. Chest X-ray shows hyperinflation and a new right lower lobe infiltrate. Laboratory results reveal leukocytosis with a white blood cell count of 15,000/ŒºL and elevated C-reactive protein. Arterial blood gas on room air shows pH 7.32, PaCO2 58 mmHg, PaO2 55 mmHg, and HCO3- 28 mEq/L. Which of the following is the most appropriate next step in the management of this patient?",
                choices: [
                    { letter: "1", text: "Administer high-flow oxygen via non-rebreather mask to achieve oxygen saturation >95%" },
                    { letter: "2", text: "Initiate non-invasive positive pressure ventilation (NIPPV) with supplemental oxygen" },
                    { letter: "3", text: "Administer nebulized short-acting beta-agonist and anticholinergic agents with controlled oxygen therapy" },
                    { letter: "4", text: "Proceed with immediate endotracheal intubation and mechanical ventilation" },
                    { letter: "5", text: "Administer intravenous corticosteroids and observe for 2 hours before further intervention" }
                ]
            }
        ];

        function loadQuestion(index) {
            const q = questions[index];
            const questionMain = document.getElementById('QuestionMain');
            
            questionMain.innerHTML = `
                <div class="alert-text">
                    ${q.question}
                </div>
                <div id="QuestionOptions">
                    <table class="options-table">
                        ${q.choices.map(choice => `
                            <tr>
                                <td>${choice.letter}</td>
                                <td>${choice.text}</td>
                            </tr>
                        `).join('')}
                    </table>
                </div>
            `;
            console.log(`‚úÖ Loaded question ${index + 1}`);
        }

        function loadQuestion1() {
            loadQuestion(0);
        }

        function loadQuestion2() {
            loadQuestion(1);
        }

        function loadQuestion3() {
            loadQuestion(2);
        }

        function loadLongQuestion() {
            loadQuestion(3);
            console.log('üìù Loaded very long medical question');
        }

        function loadDelayedChoices() {
            const questionMain = document.getElementById('QuestionMain');
            
            // Load question text first
            questionMain.innerHTML = `
                <div class="alert-text">
                    What is the powerhouse of the cell?
                </div>
                <div id="QuestionOptions">
                    <div class="alert alert-warning" style="margin-top: 16px;">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                        Loading choices...
                    </div>
                </div>
            `;
            console.log('‚è±Ô∏è Question loaded, choices will appear in 2 seconds...');
            
            // Load choices after 2 seconds
            setTimeout(() => {
                document.getElementById('QuestionOptions').innerHTML = `
                    <table class="options-table">
                        <tr><td>A</td><td>Nucleus</td></tr>
                        <tr><td>B</td><td>Mitochondria</td></tr>
                        <tr><td>C</td><td>Ribosome</td></tr>
                        <tr><td>D</td><td>Golgi apparatus</td></tr>
                    </table>
                `;
                console.log('‚úÖ Choices loaded after 2s delay');
            }, 2000);
        }

        function loadDelayedChoicesSlow() {
            const questionMain = document.getElementById('QuestionMain');
            
            // Load question text first
            questionMain.innerHTML = `
                <div class="alert-text">
                    Which organ is responsible for filtering blood?
                </div>
                <div id="QuestionOptions">
                    <div class="alert alert-warning" style="margin-top: 16px;">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                        Loading choices... (this is taking a while)
                    </div>
                </div>
            `;
            console.log('‚è±Ô∏è Question loaded, choices will appear in 5 seconds...');
            
            // Load choices after 5 seconds
            setTimeout(() => {
                document.getElementById('QuestionOptions').innerHTML = `
                    <table class="options-table">
                        <tr><td>A</td><td>Liver</td></tr>
                        <tr><td>B</td><td>Kidney</td></tr>
                        <tr><td>C</td><td>Heart</td></tr>
                        <tr><td>D</td><td>Lungs</td></tr>
                    </table>
                `;
                console.log('‚úÖ Choices loaded after 5s delay');
            }, 5000);
        }

        function loadQuestionNoChoices() {
            const questionMain = document.getElementById('QuestionMain');
            
            questionMain.innerHTML = `
                <div class="alert-text">
                    This question has no choices! (Simulates parsing error)
                </div>
                <div id="QuestionOptions">
                    <div class="alert alert-danger" style="margin-top: 16px;">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                        No choices available
                    </div>
                </div>
            `;
            console.log('‚ùå Loaded question WITHOUT choices (should trigger error handling)');
        }

        function rapidQuestionChange() {
            console.log('‚ö° Starting rapid question change test...');
            let count = 0;
            const interval = setInterval(() => {
                loadQuestion(count % 3);
                count++;
                console.log(`‚ö° Rapid change ${count}/5`);
                if (count >= 5) {
                    clearInterval(interval);
                    console.log('‚úÖ Rapid change test complete');
                }
            }, 500); // Change question every 500ms
        }

        function loadDuplicate() {
            loadQuestion(0); // Load the same question again
            console.log('üîÑ Loaded duplicate question (should be ignored by extension)');
        }

        function removeQuestion() {
            const questionMain = document.getElementById('QuestionMain');
            questionMain.innerHTML = `
                <div class="alert alert-secondary" style="text-align: center; color: var(--text-secondary);">
                    No question loaded. Click a button to load a question.
                </div>
            `;
            console.log('üóëÔ∏è Question removed');
        }
    </script>
</body>
</html>